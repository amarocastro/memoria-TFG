\section{Conceptos previos}
En este apartado se describe la arquitectura de VMware Cloud Foundation y como estructura sus componentes\footnote{Se describen solo aquellos componentes que se utilizarán en el despliegue de Cloud Foundation.} internamente.

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\iffalse
En este apartado se explican aquellos conceptos de VMware Cloud Foundation necesarios para entender su funcionamiento, configuración y requisitos de la infraestructura previos al despliegue del servicio.
\fi
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%


%% Workload Ddomains %&%&%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection{Workload Domain}
Un \textit{workload domain} consiste en una instancia lógica de un SDDC que abarca todos o parte de los recursos de uno o más clusters, cuya función es aislar el flujo de trabajo de un usuario, aplicación o un determinado tipo de tareas. Cada \textit{workload domain} se extiende sobre varios hosts y contiene su propia instancia de vCenter Server, vSAN y NSX, lo cual permite establecer políticas de control únicas para todos los \textit{workload domains} y específicas para cada uno de ellos a la vez que se simplifica la complejidad de la infraestructura. Existen \underline{tres tipos} de \textit{workload domains} que permiten aislar las tareas de gestión de la infraestructura del resto de flujos de trabajo. 

%% MANAGEMENT DOMAIN
\subsubsection{Management Domain}
\label{subsubsec:domainManagement}
Este \textit{workload domain} se crea y configura automáticamente durante el proceso de despliegue de una instancia de VMware Cloud Foundation. Su función es gestión de todos los componentes de VMware Cloud Foundation, de toda la infraestructura y del resto de \textit{workload domains} existentes en el entorno a tráves de políticas establecidas desde un único punto. Los componentes dedicados a este \textit{workload domain} son SDDC Manager, vCenter Server, dos Platform Services Controllers que son redundantes, vRealize Log Insight y un vSwitch Distributed [Fig. \ref{fig:esquemaCFComponentes}].\\
Cuando se \underline{despliega Management Domain se crean y configuran} de forma automatizada por SDDC Manager las siguientes máquinas virtuales (VM) de cada componente de Cloud Foundation:
\begin{itemize}
    \item Una VM de \textbf{SDDC Manager}: 4 vCPU, 16 GB de memoria, 800 GB de almacenamiento.
    \item Una VM de \textbf{vCenter Server}: 4 vCPU, 16 GB de memoria, 290 GB de almacenamiento.
    \item Dos instancias de \textbf{Platform Services Controller} (cada una): 2 vCPU, 4 GB de memoria, 60 GB de almacenamiento.
    \item Una VM de \textbf{NSX Manager}: 4 vCPU, 16 GB de memoria, 60 GB de almacenamiento.
    \item Tres VM de \textbf{NSX Controller} (cada una): 4 vCPU, 4 GB de memoria, 28 GB de almacenamiento.
    \item Tres VM de \textbf{vRealize Log Insight}: 8 vCPU, 16 GB de memoria, 1312 GB de almacenamiento.
\end{itemize}


%% VIRTUAL INF. DOMAIN
\begin{subsubsection}{Virtual Infrastructure Domain (VI) y Virtual Desktop Infrastructure Domain (VDI)}
\label{subsubsec:domainVI}
Este tipo de \textit{workload domain} se crea manualmente y bajo demanda desde \textit{management domain} para dar servicio a las necesidades de cada usuario o para crear diferentes entornos con finalidades distintas. Su configuración de hardware y lógica se especifican durante su proceso de creación, permitiendo indicar la cantidad de hosts, cantidad de almacenamiento, configuración de la red y políticas de rendimiento y disponibilidad, todo para satisfacer las necesidades del tipo de tareas para las que se crea. El acceso a un \textit{VI domain} se realiza a través de vSphere Client donde el administrador puede gestionar todos los recursos asociados con ese \textit{workload domain}. Cada Virtual Infrastructure Domain cuenta con sus propios vCenter Server y un NSX Manager dedicados, que se ejecutan desde el \textit{management domain} de la infraestructura, y \textit{datastore} vSAN dedicado [Fig. \ref{fig:esquemaCFComponentes}]. La diferencia entre un \textit{virtual infrastructure domain} y \textit{virtual desktop infrastructure domain} es que el segundo incorpora el producto VMware Horizon View que, resumiendo, permite desplegar escritorios virtuales.\\
Cuando se \underline{despliega un \textit{virtual infrastructure domain} se crean y configuran} de forma automatizada por el componente SDDC Manager las siguientes máquinas virtuales (VM) de cada componente de VMware Cloud Foundation:
\begin{itemize}
    \item Una VM de \textbf{vCenter Server} en Management Domain: 8 vCPU, 24 GB de memoria, 500 GB de almacenamiento.
    \item Una VM de \textbf{NSX Manager} en Management Domain: 4 vCPU, 16 GB de memoria, 60 GB de almacenamiento.
    \item Tres VM de \textbf{NSX Controller} en el VI Domain creado (cada una):  4 vCPU, 4 GB de memoria, 28 GB de almacenamiento.
\end{itemize}

\end{subsubsection}
\begin{figure}[h!]
  \centering
  \includegraphics[width=1\textwidth]{imaxes/conceptosPrevios/WDomainStructure.JPG}
  \caption{Como se estructuran y conectan los componentes de VMware Cloud Foundation.}
  \label{fig:esquemaCFDominios}
\end{figure}
\begin{figure}[h!]
  \centering
  \includegraphics[width=1\textwidth]{imaxes/conceptosPrevios/workloadDomains.png}
  \caption{Componentes dedicados de cada \textit{workload domain}.}
  \label{fig:esquemaCFComponentes}
\end{figure}


\FloatBarrier

%&%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% ARQUITECTURA
\subsection{Arquitectura}
La arquitectura de VMware Cloud Foundation tiene dos posibles modelos de despliegue dependiendo del número de hosts sobre los que se despliega VMware Cloud Foundation.

%% ESTANDAR
\subsubsection{Modelo estándar}
Este modelo se utiliza cuando VMware Cloud Foundation se despliega en un entorno con siete o más hosts. Está formado por un \underline{management domain} que se despliega en uno de los hosts y que contiene todos los componentes de gestión de toda la infraestructura [Sec. \ref{subsubsec:domainManagement}], y por \underline{virtual infrastructure domains} que se crean bajo demanda sobre el resto hosts disponibles [Sec. \ref{subsubsec:domainVI}] y una vez creado se pueden ampliar o reducir sus capacidades según sea necesario. El máximo número de \underline{virtual infrastructure domains} que se pueden desplegar en una instacia de VMware Cloud Foundation es 15.

\begin{figure}[h!]
  \centering
  \includegraphics[width=0.75\textwidth]{imaxes/conceptosPrevios/arquitect_standarCF.png}
  \caption{Esquema del modelo de arquitectura estándar.}
  \label{fig:modelostandard}
\end{figure}

\begin{figure}[h!]
  \centering
  \includegraphics[width=0.85\textwidth]{imaxes/conceptosPrevios/standardArch.png}
  \caption{Estructura de los componentes en una arquitectura estándar.}
  \label{fig:standardarch}
\end{figure}
\FloatBarrier
%%%%%%%%%%%%%%%%%%%%%
%%  CONSOLIDADO
\subsubsection{Modelo consolidado}
Este modelo se despliega cuando el entorno esta formado por menos de siete nodos. En este modelo el flujo de trabajo que corresponde al \underline{virtual infrastructure domain} y al \textit{management domain} en el despliegue estándar, está colocado dentro del mismo \underline{workload domain}, es decir, solo existe un único \textit{workload domain} denominado \textit{management domain}. Este modelo se puede convertir en un modelo estándar creando un \textit{virtual infrastructure domain}. Los flujos de trabajo se mantienen aislados gracias a sus respectivos almacenes de recursos[Fig. \ref{fig:modeloconsolidated}].

\begin{figure}[h!]
  \centering
  \includegraphics[width=0.25\textwidth]{imaxes/conceptosPrevios/modelConsolidated.png}
  \caption{Esquema del modelo de arquitectura consolidado.}
  \label{fig:modeloconsolidated}
\end{figure}

\begin{figure}[h!]
  \centering
  \includegraphics[width=0.85\textwidth]{imaxes/conceptosPrevios/consolidatedArch.png}
  \caption{Estructura de los componentes de una arquitectura consolidado.}
  \label{fig:consolidatedArch}
\end{figure}
\FloatBarrier


%%%% DISEÑO ARQUI. FÍSICA %%%%%
\begin{subsection}{Diseño arquitectura física}
En este apartado se describen las principales características que tiene el entorno físico de un SDDC construído con VMware Cloud Foundation.
\subsubsection{Tipos de clusters, zonas de disponibilidad y regiones}
Un SDDC puede estar \underline{formado por múltiples clusters} que pueden ser de diferentes tipos con diferentes propósitos. Un cluster puede ocupar uno o más \textit{racks} dependiendo del nivel de escalabilidad que se requiera. Según su función, cada \textit{workload domain} se puede colocar en un cluster diferente para gestionar la alta disponibilidad y el ciclo de vida según sus necesidades. Un \underline{cluster puede ser de varios tipos}:
\begin{itemize}
    \item \textbf{Management Cluster}: Es aquel que contiene el \textit{management domain}, por lo tanto contiene las máquinas virtuales de los componentes que gestionan el SDDC. A este cluster solo deben acceder los administradores de la infraestructura.
    \item \textbf{Shared Edge y Compute Cluster}: contiene el \textit{virtual infrastructure domain} con las máquinas virtuales de los usuarios y, además, incorpora servicios de NSX necesarios para comunicarse con redes externas y con otros \textit{workload domains}.
    \item \textbf{Compute Cluster}: solo contiene el \textit{virtual infrastructure domain} con las máquinas virtuales de los usuarios.
    \item \textbf{External Storage}: se centra en proveer almacenamiento de tipo NFS, iSCSI o Fiber Channel.
\end{itemize}

Un SDDC puede estar distribuído en una o más \underline{zonas de disponibilidad}. Estas son zonas aisladas que evitan la propagación de fallos de hosts individuales a través de toda la infraestructura, así, se puede entregar mayor disponibilidad de los recursos y servicios. A su vez, varias \underline{zonas de disponibilidad} se pueden agrupar en una \underline{región}, estos entornos separados por grandes distancias que permiten tener recuperación ante desastres [Fig. \ref{fig:AVRegiones}].\\

\begin{figure}[h!]
  \centering
  \includegraphics[width=0.95\textwidth]{imaxes/conceptosPrevios/zonasDispRegiones.png}
  \caption{Una región contiene al menos una zona de disponibilidad.}
  \label{fig:AVRegiones}
\end{figure}
\FloatBarrier

\subsubsection{Propiedades de la red}
El \underline{transporte de la red} de un SDDC con VMware Cloud Foundation se puede implementar en la capa dos, configurando los dispositivos físicos para funcionar directamente con los componentes de VMware, o en la capa tres, para usar dispositivos de transporte lógico. Cada tipo de configuración tiene sus ventajas y desventajas, pero la configuración más común en este tipo de entornos es usar el transporte de red sobre la capa tres da más libertad a la hora de gestionar y configurar los recursos físicos de red.\\


Como VMware Cloud Foundation abstrae la red física en una red virtual, la red física debe cumplir ciertos requisitos para que la red virtualizada sea robusta. Esta se debe mantener simple con configuraciones comunes en todos los switches, uso de VLANs y uso de enrutamiento dinámico, también debe ser escalable en cuanto a cantidad de hosts, ancho de banda y cantidad rutas rutas redundantes. Además, se debe tener en cuenta que cada tipo de tráfico tiene características diferentes, como por ejemplo el tráfico dedicado al almacenamiento a través de IP que suele usar mayor ancho de banda, por ello es necesario distinguir cada tipo de tráfico en la capa 2 con el protocolo CoS o en la capa 3 con el protocolo DSCP. Los \underline{principales componentes que se deben configurar} para dar conectividad entre los servidores son los siguientes:
\begin{itemize}
    \item \textbf{Top of Rack Physical Switches} (TOR): se trata de un switch que está colocado dentro de un rack y a él se conectan todos los hosts que se encuentran dentro de ese rack, a su vez, el switch TOR los conecta los hosts con el resto de la infraestructura. Estos switches \underline{se deben configurar} de forma redundante para ofrecer alta disponibilidad, los puertos que se conectan a los hosts deben estar configurados como puertos troncales, proveer servicio DHCP a cada VLAN usada y configurar los puertos para que acepten \textit{jumbo frames}. Además, se deben configurar todas las VLANs y subredes que se utilizarán en la infraestructura de VMware Cloud Foundation. \underline{Otros protocolos que se deben configura}r en los puertos que se conectan con los hosts son:
    \begin{itemize}
        \item \emph{Spanning Tree Protocol} (STP): protocolo que se encarga de gestionar las rutas de la red que son redundantes.
        \item \emph{Trunking}: protocolo que se encarga de gestionar el tráfico de múltiples redes sobre un mismo medio físico. Se establece una VLAN como nativa que se utiliza para transmitir el tráfico entre dispositivos que no implementan este protocolo. La VLAN de la red \textit{management} debe ser la VLAN nativa.
        \item \emph{MTU}: configurar el MTU de cada VLAN para el transporte de paquetes \textit{jumbo frames}. Este valor será el que se use para configurar los hosts ESXi. Se recomienda establecerlo en 9000 bytes.
        \item \emph{Multicast}: configurar el protocolo IGMP en cada switch TOR como enrutador (busca activamente que VLANs pertenecen a un grupo Multicast) y cada VLAN como miembros de IGMP (los hosts que forman parte del grupo indican su pertenencia a un grupo multicast de forma activa).
    \end{itemize}
    
    \item \textbf{Servidor DNS}: se utiliza para obtener los nombres y direcciones de todas las máquinas virtuales que se creen. Es requerido por el componente NSX.
    \item \textbf{Servidor NTP}: requerido por todos los componentes de VMware Cloud Foundation para mantenerse sincronizados.
    
    \item \textbf{Router}: debe existir enrutamiento dinámico en la red desde la capa 3. Es requerido por NSX para establecer comunicación con los ESG. 
    \iffalse
    \item \textbf{Conectividad entre Regiones}: 
    \item \textbf{Conectividad entre Zonas de dispobilidad}:
    \fi
\end{itemize}

\subsubsection{Características de un host ESXi}
Los hosts ESXi que se desplieguen en un cluster deben tener características físicas idénticas para hacer la infraestructura más manejable,  incluyendo la configuración de almacenamiento y red.
Dos de sus interfaces de red (NIC) con la misma velocidad deben estar conectadas a la VLAN \textit{trunk}. Esto junto con el componente VMware vSphere Distributed Switch permite que el tráfico se redirija de forma óptima y que las conexiones sean redundantes. Todas las conexiones físicas del host deben tener una velocidad mínima de 10 Gbit.

\subsubsection{Características del almacenamiento físico para VMware vSAN}
VMware Cloud Foundation utiliza VMware vSAN para proveer el almacenamiento de un SDDC. Para implementarlo hay que considerar los siguientes requerimientos:
\begin{itemize}
    \item Mínimo de tres hosts con recursos de almacenamiento.
    \item Determinar qué configuración de vSAN se va a utilizar, \textit{All-Flash} o \textit{Hybrid}. Se recomienda la solución \textit{All-Flash} ya que ofrece mayor rendimiento.
    \item Para cada host con recursos de almacenamiento se debe cumplir que el disco de caché tenga un 10\% de la capacidad del almacenamiento persistente del grupo, tener un mínimo de dos discos en la capa de capacidad, un controlador RAID y habilitar la opción de apagar las máquinas virtuales de un host en vSphere High Availability cuando este se encuentre aislado.
\end{itemize}

\end{subsection}



%%%%%DISEÑO ARQ. VIRTUAL
\begin{subsection}{Diseño arquitectura virtual}
La infraestructura virtual de un SDDC está formada por dos regiones, cada una con su propio \textit{management domain}, que incluye el \textit{management cluster}, y un \textit{virtual infrastructure domain} que contiene el \textit{shared cluster} y un \textit{compute cluster}. Esta capa virtual provee infraestructura de almacenamiento, red y cómputo definidas por software.

\subsubsection{Diseño de vCenter Server}
Este componente es una pieza fundamental dentro del SDDC de VMware. Se recomienda desplegar dos instancias, una que administre los componentes que gestionan el SDDC, y otra que administre los servicios \textit{edge} y los \textit{workload domains} de los usuarios, aunque esto depende del uso que se le vaya a dar al SDDC. Además, vCenter Server requiere el despliegue de dos Platform Services Controllers que se pueden colocar dentro de la misma instancia de vCenter Server.

\subsubsection{Diseño del cluster vSphere}
Se deben considerar el número y el tipo de clusters que se van a crear, según la cantidad de hosts, la capacidad de cada uno y del uso que se va a hacer de cada cluster. Además, dentro de la configuración de un cluster hay que considerar como se va a configurar el componente vSphere High Availability para reestablecer las máquinas virtuales en caso de fallo de un host.

\subsubsection{Características de la red virtual}
La red de esta infraestructura está virtualizada por VMware NSX for vSphere que utiliza los componentes vCenter Server, NSX Manager, NSX Controllers y NSX Logical Switch para establecer comunicaciones y aislar los distintos tipos de tráfico. Estos componentes \underline{actúan en diferentes planos} de la red:
\begin{itemize}
    \item \textbf{Plano de Datos}: aquí se gestionan los datos que tránsmite el tráfico. En este plano actúan NSX Logical Switches segregando los tipos de datos, y el enrutamiento y firewall distribuído de NSX. Se transmite a través de una red física dedicada al transporte.
    \item \textbf{Plano de Control}: aquí se gestionan los mensajes de control que se usan para la configuración de los dispositivos de NSX como switches, routers y firewalls en cada host ESXi. Se distribuye en redes físicas de forma segura usando VLANs para aislarlo del plano de datos.
    \item \textbf{Plano de gestión}: aquí se gestiona el tráfico dedicado a la administración de los recursos como puede ser la creación y eliminación de máquinas virtuales. Está controlado por vCenter Server y NSX Manager.
\end{itemize}

Adicionalmente, VMware NSX incluye diversos servicios que suponen una abstracción lógica de dispositivos físicos de red y que VMware Cloud Foundation utiliza para formar su infraestructura virtual. Estos \underline{servicios son los siguientes}:
\begin{itemize}
    \item \textbf{Logical Switches}: permite crear segmentos abstractos que representan dominios de broadcasting donde se colocan determinadas máquinas virtuales. Su tráfico tiene asignado una única VLAN y están mapeados en todos los hosts lo cual simplifica la movilidad de las máquinas virtuales entre los hosts.
    \item \textbf{Universal Distributed Logical Router} (UDLR): realiza las funciones de enrutamiento entre máquinas virtuales sobre puertos con VXLAN. Son controlados por una máquina virtual y utilizan protocolos de enrutamiento dinámico como BGP y OSPF.
    \item \textbf{Designated Instance}: host ESXi encargado de resolver las solicitudes del protocolo ARP. Es elegido por NSX Controller que escoge un host por cada VLAN existente.
    \item \textbf{Edge Services Gateway} (ESG): es el encargado de proveer conectividad a través de la infraestructura física para que los componentes se puedan conectar a redes externas u otras redes del la infraestructura. También aporta firewall de perímetro, balanceo de carga y SSL-VPN. Forma parte del componente NSX Edge.
    \item \textbf{Logical Firewall}: provee mecanismos de seguridad que se asemejan a las funciones de los firewalls físicos pero con la ventaja de la virtualización, lo cual hace que su configuración sea más flexible. Trabaja al nivel de puertos \textit{vmkernel} y máquinas virtuales
    \item \textbf{Logical Load Balancer}: distribuye el tráfico entre los servidores para que el uso de recursos sea el óptimo.
    \item \textbf{VXLAN Tunnel Endpoint} (VTEP): punto donde se encapsula el tráfico de VXLAN en paquetes UDP. Se ubican en los puertos \textit{vmkernel} de un vSphere Distributed Switch.
\end{itemize}

En el diseño recomendado de las redes virtuales que se deben crear se puede ver en la figura \ref{fig:redesVirtuales}. Durante su diseño \underline{hay que tener en cuenta lo siguiente}:
\begin{itemize}
    \item Segmentar los diferentes tipos de tráfico para mejorar la eficiencia de la red y la seguridad. Algunos servicios requieren una latencia baja para funcionar correctamente.
    \item Establecer las redes que se van a crear según el tipo de tráfico.
    \item Utilizar un único vSphere Distributed Switch por cluster con las distintas redes dedicadas a cada servicio y con diferentes VLANs.
    \item Colocar el tráfico de vMotion en una red dedicada.
    \item Utilizar NICs en la máquinas virtuales del tipo VMXNET3 para mejorar el rendimiento.
    \item Las NICs físicas de cada host ESXi conectadas a un mismo vSphere Distributed Switch deben estar conectadas también a la misma red física.
    \item Aquellas redes que se dedican a servicios de la infraestructura deben estar configuradas con puertos tipo \textit{vmkernel}.
\end{itemize}

\begin{figure}[h!]
  \centering
  \includegraphics[width=0.65\textwidth]{imaxes/conceptosPrevios/redesVDSCluster.png}
  \caption{Redes virtuales que se deben crear en en la infraestructura.}
  \label{fig:redesVirtuales}
\end{figure}
\FloatBarrier

Respecto a los componentes de gestión de las operaciones que forman parte de la suite VMware vRealize, estos se colocan en una red virtual separada donde solo son accesibles a través de un punto. Esta red contiene una VXLAN que conecta con un UDLR que redirige el tráfico con otras redes a través de los nodos de NSX ESGs. La red entre los nodos de NSX ESGs y el UDLR se demomina red de tránsito [Fig. \ref{fig:vrealizeArch}]. En la figura [\ref{fig:udlrArch}] se puede ver como se estructura el tráfico desde la máquinas virtuales a cada switch TOR usando enrutamiento dinámico.

\begin{figure}[h!]
  \centering
  \includegraphics[width=0.6\textwidth]{imaxes/conceptosPrevios/vrealizeARCH.png}
  \caption{Red virtual constuída para alojar los componentes de VMweare vRealize.}
  \label{fig:vrealizeArch}
\end{figure}
\begin{figure}[h!]
  \centering
  \includegraphics[width=0.6\textwidth]{imaxes/conceptosPrevios/UDLRroutingNSX.png}
  \caption{Arquitectura del enrutamiento dinámico de NSX.}
  \label{fig:udlrArch}
\end{figure}
\FloatBarrier


\subsubsection{Diseño del almacenamiento virtual}
VMware vSAN forma único \textit{datastore} con todos los dispositivos de almacenamiento que se encuentran en la infraestructura permitiendo establecer políticas y gestionar esos recursos de forma más simple. Para que funcione correctamente es necesario \underline{configurar una red para VMware vSAN} teniendo en cuenta los siguientes aspectos:
\begin{itemize}
    \item El uso de vSpehere Distributed Switches genera mejor rendimiento.
    \item Se recomienda el uso de paquetes tipo \textit{jumbo frames}.
    \item Asignar una VLAN al tráfico de cada cluster de VMware vSAN.
    \item Si se implementa en un SDDC con dos localizaciones, es necesario establecer un host \textit{witness}.
\end{itemize}
Al establecer el tamaño y capacidad de este cluster hay que tener en cuenta que cuantos más hosts ESXi se incluyan, mayor tolerancia a fallos se tendrá y mejor se podrán repartir los grupos de discos entre todos los hosts. Debe haber un balance entre el hardware y la capacidad requerida.

\end{subsection}
\begin{subsection}{Gestión de las operaciones de la arquitectura}
En este apartado se define como se gestionan en VMware Cloud Foundation las tareas de administración de todas las partes de la infraestructura. Estas tareas se agrupan en la gestión del ciclo de vida y la recopilación de información sobre el estado de cada componente existente.

\subsubsection{Gestión del ciclo de vida}
Elementos que se encargan de administrar el ciclo de vida de los componentes:
\begin{itemize}
    \item \textbf{vSphere Update Manager}: pensado para la adminstración del entorno vSphere. Permite administrar las actualizaciones que reciben los hosts ESXi, instalar software de terceros en los hosts ESXi y actualizar el hardware virtual de las máquinas virtuales. Existe una instancia de este producto por cada vCenter Server. En su arquitectura existe otro elemento llamado \textbf{Update Manager Download Service} (UMDS) y representa un entorno con acceso a la red pública donde se descargan los archivos requeridos por vSphere Update Manager [Fig. \ref{fig:updateManager}], ya que este se encuentra en un entorno aislado. Esto incrementa la seguridad y permite compartir estos archivos entre distintas instancias de vSphere Update Manager.
    
    \item \textbf{vRealize Suite Licfecycle Manager}: elemento encargado de administrar el ciclo de vida de todos los productos de vRealize de forma automatizada, esto incluye el despliegue y actualización de vRealize Operations Manager, vRealize Log Insgiht y vRealize Automation. Este se conecta a un servicio externo para descargar los archivos que se necesiten [Fig. \ref{fig:vrealizeUpdateManager}]. La instancia de este producto reside en la la Zona de Disponibilidad 1 dentro de la Region A.
    
\end{itemize}

\begin{figure}[h!]
  \centering
  \includegraphics[width=0.8\textwidth]{imaxes/conceptosPrevios/vSphereUpdate.png}
  \caption{Estructura de la gestión del ciclo de vida con vSphere Update Manager.}
  \label{fig:updateManager}
\end{figure}
\begin{figure}[h!]
  \centering
  \includegraphics[width=0.8\textwidth]{imaxes/conceptosPrevios/vRealizeUpdateArchLifeCyle.png}
  \caption{Estructura de la gestión del ciclo de vida con vRealize Suite Lifecycle Manager.}
  \label{fig:vrealizeUpdateManager}
\end{figure}
\FloatBarrier

\subsubsection{Monitorización}
En VMware Cloud Foundation la monitorización de la infraestructura es realizada por vRealize Log Insight que provee gestión y análisis de los logs de la infraestructura. Este componente conecta con todos los prodcutos de VMware y recoge información sobre las alarmas, tareas y eventos que tienen lugar usando el protocolo syslog.\\

Su modelo de despliegue está formado por un nodo \textit{Master} y dos nodos \textit{Worker}, además, se puede habilitar alta disponibilidad su balanceador de carga \textit{Integrated Load Balancer} (ILB), este último es quien recibe las peticiones de logs de los clientes y luego las retransmite a los nodos \textit{worker} y \textit{master} para obtener la información. El producto vRealize Log Insight se despliega en la Zona de Disponibilidad 1 dentro de la Region A.





\end{subsection}


%%% CLOUD BUILDER
\subsection{Cloud Foundation Builder VM Support}
\label{subsec:cloudBuilder}
El despliegue de la plataforma VMware Cloud Foundation se realiza través de una máquina virtual llamada Cloud Foundation Builder. Esta máquina recoge la configuración que se indica en la hoja de parámetros, los valida, , despliega y configura el \underline{Management Domain}. Al final del proceso, transfiere el inventario y el control del sistema al componente SDDC Manager y esta máquina virtual puede ser eliminada.\\

\subsection{Red, almacenamiento y servicios necesarios para el despliegue}

\subsubsection{Servicios internos}
\label{subsubsec:servInterno}
Durante el despliegue Cloud Foundation, hay servicios y puertos deben estar habilitados en cada nodo ESXi para Cloud Foundation Builder (Fig. \ref{fig:puertosCB}) y SDDC Manager (Fig. \ref{fig:puertosSDDC}) puedan acceder a todos los componentes.

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\iffalse
\begin{figure}[h!]
  \centering
  \includegraphics[width=0.7\textwidth]{imaxes/conceptosPrevios/puertosentradaCB.png}
  \includegraphics[width=0.7\textwidth]{imaxes/conceptosPrevios/puertossalidaCB.png}
  \caption{Servicios y puertos de entrada y salida habilitados para Cloud Foundation Builder.}
  \label{fig:puertosCB}
\end{figure}

\begin{figure}[h!]
  \centering
  \includegraphics[width=0.7\textwidth]{imaxes/conceptosPrevios/puertosentradaSDDC.png}
  \includegraphics[width=0.7\textwidth]{imaxes/conceptosPrevios/puertossalidaSDDC.png}
  \caption{Servicios y puertos de entrada y salida habilitados para SDDC Manager.}
  \label{fig:puertosSDDC}
\end{figure}
\fi
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\begin{figure}[h!]
  \centering
  \includegraphics[width=1\textwidth]{imaxes/conceptosPrevios/firewall_CloudBuilder.png}
  \caption{Servicios y puertos de entrada y salida habilitados para Cloud Foundation Builder.}
  \label{fig:puertosCB}
\end{figure}
\begin{figure}[h!]
  \centering
  \includegraphics[width=1\textwidth]{imaxes/conceptosPrevios/firewall_SDDC.png}
  \caption{Servicios y puertos de entrada y salida habilitados para SDDC Manager.}
  \label{fig:puertosSDDC}
\end{figure}

\FloatBarrier

\subsubsection{Servicios externos}
\label{subsubsec:servExterno}
En este apartado se describen aquellos servicios necesarios para el despliegue de VMware Cloud Foundation. Estos servicios deben estar configurados antes del despliegue de VMware Cloud Foundation para que todos los componentes se puedan comunicar antes, durante y después del despliegue. Se pueden configurar en servidores instalados en máquinas virtuales dentro del entorno y estas deben tener acceso a la red \textit{VM Network}.\\
\begin{itemize}
    
    \item \textbf{Dynamic Host Configuration Protocol (DHCP)}: Permite configurar automáticamente cada puerto VMkernel de un nodo con IPv4. 
    
    \item \textbf{Domain Name Server (DNS)}: Un servidor DNS debe estar disponible para todos los componentes desde el momento de despliegue. También se debe especificar el nombre del dominio. Con esto los componentes pueden obtener tanto el nombre como la dirección IP de un elemento en la red. Los componentes y servicios de la plataforma que usan este servicio son NTP, Platform Services Controller, instancias de vCenter Server, instancias de NSX Manager y vRealize Log Insight.
    
    \item \textbf{Network Time Protocol (NTP)}: Permite la sincronizar el tiempo en todos los nodos de la infraestructura. Durante el despliegue se debe especificar la dirección IP de al menos un servidor NTP.
    
    \item \textbf{Router}: Se requiere un router con el protocolo de enrutamiento \textit{\textbf{Border Gateway Protocol}} (BGP) habilitado y configurado para compartir todas las rutas por toda la red del entorno.
    Este router debe tener configuradas cuatro interfaces para las distintas redes que se generan en la arquitectura de VMware Cloud Foundation.
    
\end{itemize}

Se puede encontrar más información sobre otros servicios opcionales en el siguiente \href{https://docs.vmware.com/en/VMware-Cloud-Foundation/3.9/com.vmware.vcf.planprep.doc_39/GUID-F022BD3C-F11C-4EE6-83EA-ABE016E7A9B9.htm}{enlace}.
\FloatBarrier

%%%%% RED 
\subsubsection{Red física}
\label{subsubsec:redFisica}
La red física debe admitir las siguientes características:
\begin{itemize}
    \item \textbf{VLAN}: etiquetado de redes VLAN (802.1Q)
    \item \textbf{Jumbo Frames}: MTU mínimo igual a 1600, aunque se recomienda que sea igual a 9000.
\end{itemize}

\subsubsection{Red lógica}
\label{subsubsec:redLogicaCF}
\iffalse
Antes del despliegue es necesario especificar varias redes que más tarde Cloud Foundation usará para automatizar la configuración de puertos \ref{Word:vmkernel} cuando se añade un nuevo host al entorno o se crea un VI Domain. Estas redes son  una dedicada al servicio \underline{vSAN}, otra dedicada a \underline{vMotion}, ota de dedicada a la gestión de los componentes y otra dedicada al tráfico de las máquinas virtuales. Los datos a especificar son la etiqueta VLAN, MTU, IP de la red, máscara, gateway y el rango de direcciones IP. Una vez creadas solo se puede modificar el rango de direcciones IP.\\
Es importante utilizar VLANs e IPs ya que es en lo que se basa Cloud Foundation para aislar cada tipo de tráfico de la infraestructura. La cantidad de subredes necesarias depende del número de Workload Domains que se creen, número de clusters y otros componentes opcionales.
\fi

Antes de iniciar el despliegue de VMware Cloud Foundation, el entorno sobre el que se instalará la plataforma debe tener configurado un vSphere Distributed Switch, una llamada \textit{Management Network} que se dedicará a la transmisión del tráfico generado entre los distintos componentes del entorno, y otra llamada \textit{VM Network} que se dedicará al tráfico generado por las máquinas virtuales que se desplieguen sobre la plataforma. La red \textit{Management Network} se puede configurar con etiquetado VLAN, en ese caso la red \textit{VM Network} debe tener la misma etiqueta VLAN. Los vSwitches creados deben tener un MTU igual a 1600 como mínimo. Además, es necesario conocer de antemano las direcciones IP que se asginarán a cada componente de la infraestructura durante el despliegue de la plataforma.


%%% ARQUITECTURA DE LA RED CLOUD FOUNDATION
\subsubsection{Arquitectura de la red}
En este apartado se describe la red que forma VMware Cloud Foundation cuando despliega las máquinas virtuales de su principales componentes y como estructura sus conexiones con los elementos ya existentes.\\
Como ya hemos visto, los diferentes servicios de esta plataforma se implementan en forma de máquinas virtuales que se conectan entre si a través de una red creada en base a los elementos de red virtualizados de VMware como \textit{Distributed Switches}, \textit{vSwitches}, \textit{vmkernels} y \textit{vmportgroups}. Esta red se denomina \textit{Management Network} y a través de esta todos 



\subsubsection{Almacenamiento}
Según la documentación de vSAN, cada host ESXi del entorno debe tener como mínimo un grupo de discos. Un nodo puede tener hasta cinco grupos de discos, dentro de los cuales debe haber al menos un disco de caché y un disco de capacidad. Cada grupo de discos puede contener hasta siete discos de capacidad.
En cuanto al tipo de disco que se debe utilizar, los discos de caché deben ser SSD y los discos de capacidad pueden ser SSD o HDD, según el modelo que se quiera implementar (All-Flash o híbrido).

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

